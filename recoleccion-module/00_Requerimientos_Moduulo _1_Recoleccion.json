{
  "requerimientos": [
    {
      "codigo": "RF-REC-01",
      "modulo": "Recolección",
      "nombre": "Registrar recolección (BORRADOR)",
      "descripcion": "Permitir crear una recolección en estado BORRADOR y editarla hasta su validación.",
      "campos": [
        "- Identificador único",
        "- Estado del registro: BORRADOR (default) / VALIDADO",
        "- Estado operativo (derivado): ABIERTO / CERRADO",
        "- Fecha de recolección ✅ (Obligatorio)",
        "- Especie: nombre científico + nombre comercial ✅ (Obligatorio)",
        "- Método de recolección ✅ (Obligatorio)",
        "- Tipo de material: SEMILLA o ESQUEJE ✅ (Obligatorio)",
        "- Cantidad inicial ✅ (Obligatorio)",
        "- Unidad canónica (derivada): g o unidad para SEMILLA / solo unidad para ESQUEJE",
        "- Saldo actual (derivado por movimientos)",
        "- Recolector ✅ (Obligatorio)",
        "- Lugar de almacenamiento (vivero) ✅ (Obligatorio)",
        "- Ubicación RF-REC-02 ✅ (Obligatorio)",
        "- Fotografías ✅ (Obligatorio)",
        "- Observaciones (Opcional)"
      ],
      "validaciones": [
        "- La fecha no puede ser futura.",
        "- La cantidad inicial debe ser > 0.",
        "- Para SEMILLA: normalizar a gramos (unidad canónica) o se mantiene con unidad de ser el caso.",
        "- Para ESQUEJE: cantidad entera estricta.",
      ],
      "reglas_adicionales": [
        "- En BORRADOR no se considera registro sellado (no es historia oficial).",
        "- Se registran automáticamente campos de auditoría (creado_por/creado_en/actualizado_por/actualizado_en)."
      ]
    },
    {
      "codigo": "RF-REC-02",
      "modulo": "Recolección",
      "nombre": "Ubicación estructurada",
      "descripcion": "Permitir asociar ubicación GPS y estructura administrativa por catálogos.",
      "campos": [
        "- País Obligatorio por catalogo, por defecto BOLIVIA",
        "- Comunidad o Localidad (Obligatorio por catálogo)",
        "- Latitud y Longitud (Obligatorio para BORRADOR y VALIDAR)"
      ],
      "validaciones": [
        "- Latitud en rango [-90, 90] con 6 decimales.",
        "- Longitud en rango [-180, 180] con 6 decimales.",
        "- Si se envían IDs administrativos, deben existir en catálogo y ser coherentes."
      ],
      "reglas_adicionales": [
        "- Si un dato administrativo no existe en catálogo, usar 'SIN ESPECIFICAR' (MVP) y despues para pasar a VALIDADO se lo puede corregir pero es OBLIGATORIO que exista en el catálogo para pasar a VALIDADO."
      ]
    },
    {
      "codigo": "RF-REC-03",
      "modulo": "Recolección",
      "nombre": "Edición/actualización + historial",
      "descripcion": "Permitir editar la ficha solo en BORRADOR y guardar historial inmutable; en VALIDADO solo movimientos.",
      "campos": [
        "- Usuario que modificó",
        "- Fecha y hora",
        "- Versión antigua / versión nueva (o diff)",
        "- Motivo (recomendado; obligatorio para correcciones post-validación)"
      ],
      "validaciones": [
        "- En VALIDADO no se permite editar la ficha (solo registrar movimientos).",
        "- El historial no se puede borrar."
      ],
      "reglas_adicionales": [
        "- Los cambios se guardan en tablas separadas.",
        "- Se registra cualquier cambio relevante (campos clave, fotos, ubicación, transición a VALIDADO, movimientos)."
      ]
    },
    {
      "codigo": "RF-REC-04",
      "modulo": "Recolección",
      "nombre": "Validar y sellar recolección",
      "descripcion": "Permitir pasar de BORRADOR a VALIDADO cuando el registro cumpla evidencias y ubicación, y anclarlo a blockchain.",
      "campos": [
        "- Cambio de estado: BORRADOR → VALIDADO",
        "- Usuario validador",
        "- Fecha/hora de validación",
        "- Hash/snapshot del registro sellado",
        "- Identificador de anclaje en blockchain (tx o referencia)"
      ],
      "validaciones": [
        "- Para VALIDAR se exige: ≥2 fotos + lat/long válidas + campos mínimos completos.",
        "- No se permite volver de VALIDADO a BORRADOR."
      ],
      "reglas_adicionales": [
        "- Al VALIDAR se considera el registro como historia oficial (sellado)."
      ]
    },
    {
      "codigo": "RF-REC-05",
      "modulo": "Recolección",
      "nombre": "Movimientos e inventario (saldo)",
      "descripcion": "Registrar movimientos append-only que alteran el saldo: consumo a vivero, desecho y corrección.",
      "campos": [
        "- Tipo de movimiento: CONSUMO_A_VIVERO / DESECHO / CORRECCIÓN",
        "- Delta (positivo o negativo) en unidad canónica respectiva",
        "- Motivo (obligatorio para DESECHO y CORRECCIÓN)",
        "- Fecha/hora del movimiento",
        "- Usuario responsable",
        "- Referencia opcional a lote de vivero (en CONSUMO_A_VIVERO)",
        "- Saldo resultante (derivado)"
      ],
      "validaciones": [
        "- No permitir que el saldo quede < 0.",
        "- CONSUMO_A_VIVERO requiere recolección VALIDADO y saldo suficiente.",
        "- CORRECCIÓN requiere rol autorizado."
      ],
      "reglas_adicionales": [
        "- Cada movimiento se ancla a blockchain (MVP).",
        "- El estado operativo ABIERTO/CERRADO se recalcula según saldo."
      ]
    }
  ]
}